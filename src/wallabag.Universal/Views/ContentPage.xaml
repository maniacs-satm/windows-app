<Page
    x:Class="wallabag.Views.ContentPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:common="using:wallabag.Common"
    xmlns:controls="using:wallabag.Controls"
    xmlns:conv="using:wallabag.Converter"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:wallabag.Views"
    xmlns:m="using:wallabag.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:t10="using:Template10.Controls"
    xmlns:vm="using:wallabag.ViewModels"
    common:TitleBarExtensions.BackgroundColor="{ThemeResource SystemAccentColor}"
    common:TitleBarExtensions.ButtonBackgroundColor="{ThemeResource SystemAccentColor}"
    common:TitleBarExtensions.ButtonForegroundColor="White"
    common:TitleBarExtensions.ForegroundColor="White"
    DataContext="{Binding Main, Source={StaticResource Locator}}"
    mc:Ignorable="d">
    <Page.Resources>
        <conv:BooleanToVisibilityNegatedConverter x:Key="BooleanToVisibilityNegatedConverter" />
        <DataTemplate x:Name="PivotContentTemplate" x:DataType="vm:MainViewModel">
            <controls:AdaptiveGridView
                x:Name="ItemGridView"
                Padding="4"
                EntranceNavigationTransitionInfo.IsTargetElement="True"
                IsItemClickEnabled="{x:Bind IsMultipleSelectionEnabled, Mode=OneWay, Converter={StaticResource BooleanNegationConverter}}"
                ItemsSource="{x:Bind Items}"
                Loaded="ItemGridView_Loaded"
                MinItemHeight="200"
                MinItemWidth="300">
                <GridView.ItemTemplate>
                    <DataTemplate x:DataType="vm:ItemViewModel">
                        <controls:ItemControl />
                    </DataTemplate>
                </GridView.ItemTemplate>
                <interactivity:Interaction.Behaviors>
                    <core:EventTriggerBehavior EventName="ItemClick">
                        <core:InvokeCommandAction Command="{x:Bind ItemClickCommand}" />
                    </core:EventTriggerBehavior>
                </interactivity:Interaction.Behaviors>
            </controls:AdaptiveGridView>
        </DataTemplate>
        <Style TargetType="PivotHeaderItem">
            <Setter Property="RequestedTheme" Value="Dark" />
        </Style>
        <Style TargetType="PivotItem">
            <Setter Property="Margin" Value="0,0,0,48" />
        </Style>
        <MenuFlyout x:Key="ItemContextMenu">
            <MenuFlyoutItem
                x:Name="ContextMenuMarkAsRead"
                x:Uid="MarkAsReadMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuMarkAsRead_Click"
                Tag="&#xE001;"
                Text="Mark as read"
                Visibility="{Binding Model.IsRead, Converter={StaticResource BooleanToVisibilityNegatedConverter}}" />
            <MenuFlyoutItem
                x:Name="ContextMenuUnmarkAsRead"
                x:Uid="UnmarkAsReadMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuMarkAsRead_Click"
                Tag="&#xE109;"
                Text="Unmark as read"
                Visibility="{Binding Model.IsRead, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <MenuFlyoutItem
                x:Name="ContextMenuMarkAsFavorite"
                x:Uid="MarkAsFavoriteMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuMarkAsFavorite_Click"
                Tag="&#xE00B;"
                Text="Mark as favorite"
                Visibility="{Binding Model.IsStarred, Converter={StaticResource BooleanToVisibilityNegatedConverter}}" />
            <MenuFlyoutItem
                x:Name="ContextMenuUnmarkAsFavorite"
                x:Uid="UnmarkAsFavoriteMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuMarkAsFavorite_Click"
                Tag="&#xE006;"
                Text="Unmark as favorite"
                Visibility="{Binding Model.IsStarred, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem
                x:Name="ContextMenuShareItem"
                x:Uid="ShareMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuShareItem_Click"
                Tag="&#xE72D;"
                Text="Share" />
            <MenuFlyoutItem
                x:Name="ContextMenuOpenInBrowser"
                x:Uid="OpenInBrowserMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuOpenInBrowser_Click"
                Tag="&#xE12B;"
                Text="Open in browser" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem
                x:Name="ContextMenuDeleteItem"
                x:Uid="DeleteMenuFlyoutItem"
                Style="{StaticResource MenuFlyoutItemIconTemplate}"
                Click="ContextMenuDeleteItem_Click"
                Tag="&#xE107;"
                Text="Delete" />
        </MenuFlyout>
        <Style x:Key="MenuFlyoutItemIconTemplate" TargetType="MenuFlyoutItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuFlyoutItem">
                        <Grid
                            x:Name="LayoutRoot"
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="LayoutRoot" Storyboard.TargetProperty="Background">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlHighlightListLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TextBlock" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlHighlightAltBaseHighBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="LayoutRoot" Storyboard.TargetProperty="Background">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlHighlightListMediumBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TextBlock" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlHighlightAltBaseHighBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerDownThemeAnimation Storyboard.TargetName="TextBlock" />
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TextBlock" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualStateGroup.Transitions>
                                        <VisualTransition From="Pressed" To="Normal">
                                            <Storyboard>
                                                <PointerUpThemeAnimation Storyboard.TargetName="TextBlock" />
                                            </Storyboard>
                                        </VisualTransition>
                                        <VisualTransition From="Pressed" To="PointerOver">
                                            <Storyboard>
                                                <PointerUpThemeAnimation Storyboard.TargetName="TextBlock" />
                                            </Storyboard>
                                        </VisualTransition>
                                    </VisualStateGroup.Transitions>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="CheckPlaceholderStates">
                                    <VisualState x:Name="NoPlaceholder" />
                                    <VisualState x:Name="CheckPlaceholder">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TextBlock" Storyboard.TargetProperty="Margin">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource MenuFlyoutItemPlaceholderThemeThickness}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="PaddingSizeStates">
                                    <VisualState x:Name="DefaultPadding" />
                                    <VisualState x:Name="NarrowPadding">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="LayoutRoot" Storyboard.TargetProperty="Padding">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource MenuFlyoutItemThemePaddingNarrow}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <StackPanel Orientation="Horizontal">
                                <FontIcon
                                    x:Name="TextBlock"
                                    Width="16"
                                    Height="16"
                                    Margin="0,0,12,0"
                                    FontSize="16"
                                    Glyph="{TemplateBinding Tag}" />
                                <TextBlock
                                    HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Foreground="{TemplateBinding Foreground}"
                                    Text="{TemplateBinding Text}"
                                    TextTrimming="CharacterEllipsis" />
                            </StackPanel>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Storyboard x:Name="ShowDragDropGridStoryboard">
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="dragDropGrid" Storyboard.TargetProperty="(UIElement.Visibility)">
                <DiscreteObjectKeyFrame KeyTime="0">
                    <DiscreteObjectKeyFrame.Value>
                        <Visibility>Visible</Visibility>
                    </DiscreteObjectKeyFrame.Value>
                </DiscreteObjectKeyFrame>
            </ObjectAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="dragDropGrid" Storyboard.TargetProperty="(UIElement.Opacity)">
                <EasingDoubleKeyFrame KeyTime="0" Value="0" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="1" />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Name="HideDragDropGridStoryboard">
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="dragDropGrid" Storyboard.TargetProperty="(UIElement.Visibility)">
                <DiscreteObjectKeyFrame KeyTime="0:0:0.3">
                    <DiscreteObjectKeyFrame.Value>
                        <Visibility>Collapsed</Visibility>
                    </DiscreteObjectKeyFrame.Value>
                </DiscreteObjectKeyFrame>
            </ObjectAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="dragDropGrid" Storyboard.TargetProperty="(UIElement.Opacity)">
                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="0" />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </Page.Resources>

    <Grid
        Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
        AllowDrop="True"
        DragEnter="Grid_DragEnter"
        DragLeave="Grid_DragLeave"
        Drop="Grid_Drop">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <Storyboard x:Name="SyncStoryboard" RepeatBehavior="Forever">
                        <DoubleAnimation
                            d:IsOptimized="True"
                            Duration="0:0:1"
                            Storyboard.TargetName="syncIcon"
                            Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)"
                            To="360" />
                    </Storyboard>
                    <VisualState.StateTriggers>
                        <StateTrigger IsActive="{Binding IsSyncing}" />
                    </VisualState.StateTriggers>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Rectangle
            Height="48"
            VerticalAlignment="Top"
            Fill="{ThemeResource SystemControlBackgroundAccentBrush}" />
        <Pivot>
            <Pivot.HeaderTemplate>
                <DataTemplate>
                    <TextBlock
                        Margin="0"
                        Style="{StaticResource PageTitleTextBlockStyle}"
                        Text="{Binding}" />
                </DataTemplate>
            </Pivot.HeaderTemplate>
            <PivotItem ContentTemplate="{StaticResource PivotContentTemplate}" Header="UNREAD" />
            <PivotItem ContentTemplate="{StaticResource PivotContentTemplate}" Header="FAVORITES" />
            <PivotItem ContentTemplate="{StaticResource PivotContentTemplate}" Header="ARCHIVED" />
        </Pivot>

        <Button
            Margin="6"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Background="Transparent"
            RequestedTheme="Dark">
            <StackPanel Orientation="Horizontal">
                <TextBlock
                    Margin="8,0"
                    VerticalAlignment="Center"
                    FontWeight="SemiBold"
                    Text="{x:Bind ViewModel.NumberOfOfflineTasks, Mode=OneWay}" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontFamily="Segoe MDL2 Assets"
                    FontSize="24"
                    Text="&#xE753;" />
            </StackPanel>
        </Button>
        <CommandBar x:Name="PrimaryCommandBar" VerticalAlignment="Bottom">
            <AppBarToggleButton
                Click="EnableMultipleSelection"
                Icon="Bullets"
                IsChecked="{x:Bind ViewModel.IsMultipleSelectionEnabled, Mode=TwoWay}"
                Label="Select" />
            <AppBarButton
                x:Name="searchToggleButton"
                x:Uid="SearchAppBarButton"
                Icon="Find"
                Label="Search" />
            <AppBarButton
                x:Name="syncAppBarButton"
                x:Uid="SyncAppBarButton"
                Command="{Binding RefreshCommand}"
                Label="Sync">
                <AppBarButton.Icon>
                    <SymbolIcon
                        x:Name="syncIcon"
                        RenderTransformOrigin="0.5,0.5"
                        Symbol="Sync">
                        <SymbolIcon.RenderTransform>
                            <CompositeTransform />
                        </SymbolIcon.RenderTransform>
                    </SymbolIcon>
                </AppBarButton.Icon>
            </AppBarButton>
            <AppBarButton
                x:Name="addItemAppBarButton"
                x:Uid="AddItemAppBarButton"
                Icon="Add"
                Label="Add item"
                Command="{x:Bind ViewModel.AddItemCommand}"/>
            <CommandBar.SecondaryCommands>
                <AppBarButton
                    x:Uid="OpenSettingsAppBarButton"
                    Command="{Binding NavigateToSettingsPageCommand}"
                    Icon="Setting"
                    Label="Settings" />
            </CommandBar.SecondaryCommands>
        </CommandBar>
        <CommandBar
            x:Name="MultipleSelectionCommandBar"
            VerticalAlignment="Bottom"
            Visibility="{x:Bind ViewModel.IsMultipleSelectionEnabled, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
            <AppBarButton
                x:Uid="EditMultipleItemsAppBarButton"
                Icon="Edit"
                Label="Edit">
                <AppBarButton.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem
                            x:Name="MarkItemsAsReadMenuFlyoutItem"
                            x:Uid="MarkAsReadMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Command="{x:Bind ViewModel.MarkItemsAsReadCommand}"
                            Tag="&#xE001;"
                            Text="Mark as read" />
                        <MenuFlyoutItem
                            x:Name="UnmarkItemsAsReadMenuFlyoutItem"
                            x:Uid="UnmarkAsReadMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Command="{x:Bind ViewModel.UnmarkItemsAsReadCommand}"
                            Tag="&#xE109;"
                            Text="Unmark as read" />
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem
                            x:Name="MarkItemsAsFavoriteMenuFlyoutItem"
                            x:Uid="MarkAsFavoriteMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Command="{x:Bind ViewModel.MarkItemsAsFavoriteCommand}"
                            Tag="&#xE00B;"
                            Text="Mark as favorite" />
                        <MenuFlyoutItem
                            x:Name="UnmarkItemsAsFavoriteMenuFlyoutItem"
                            x:Uid="UnmarkAsFavoriteMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Command="{x:Bind ViewModel.UnmarkItemsAsFavoriteCommand}"
                            Tag="&#xE006;"
                            Text="Unmark as favorite" />
                        <MenuFlyoutSeparator />
                        <MenuFlyoutItem
                            x:Name="ManageTagsMenuFlyoutItem"
                            x:Uid="ManageTagsMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Click="ManageTagsMenuFlyoutItem_Click"
                            IsEnabled="False"
                            Tag="&#xE1CB;"
                            Text="Manage tags" />
                        <MenuFlyoutItem
                            x:Name="DeleteMenuFlyoutItem"
                            x:Uid="DeleteMenuFlyoutItem"
                            Style="{StaticResource MenuFlyoutItemIconTemplate}"
                            Command="{x:Bind ViewModel.DeleteItemsCommand}"
                            Tag="&#xE107;"
                            Text="Delete" />
                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>
            <AppBarButton
                x:Uid="CancelAppBarButton"
                Click="DisableMultipleSelection"
                Icon="Cancel"
                Label="Cancel" />
        </CommandBar>
        <Grid
            x:Name="dragDropGrid"
            Background="#F2FFFFFF"
            Opacity="0"
            Visibility="Collapsed">
            <TextBlock
                x:Uid="DragDropTextBlock"
                Margin="32"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Style="{StaticResource HeaderTextBlockStyle}"
                Foreground="{ThemeResource SystemControlForegroundAccentBrush}"
                Text="Drop the link here to save it in your wallabag!"
                TextAlignment="Center"
                TextWrapping="Wrap" />
        </Grid>
    </Grid>
</Page>
